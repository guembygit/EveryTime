@model List<Event>

<h2>Demandes</h2>

<table class="table">
    <thead>
        <tr>
            <th>Employé</th>
            <th>Type</th>
            <th>Période</th>
            <th>Motif</th>
            <th>Justificatif</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var e in Model)
        {
            <tr data-id="@e.Id">
                <td>@e.User.FirstName @e.User.LastName</td>
                <td>@e.EventType.Name</td>
                <td>@e.StartDate.ToShortDateString() - @e.EndDate.ToShortDateString()</td>
                <td>@e.Motif</td>
                <td>
                    @if (!string.IsNullOrEmpty(e.Justificatif))
                    {
                        <a href="@e.Justificatif" target="_blank">Voir</a>
                    }
                </td>
                <td class="action-cell">
                    @if (e.Status == EventStatus.Pending)
                    {
                        <button class="btn btn-success approve-btn" data-id="@e.Id">Approuver</button>
                        <button class="btn btn-danger reject-btn" data-id="@e.Id">Rejeter</button>
                    }
                    else if (e.Status == EventStatus.Approved)
                    {
                        <span class="text-success">Approuvé</span>
                    }
                    else if (e.Status == EventStatus.Rejected)
                    {
                        <span class="text-danger">Rejeté</span>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script>
        $(document).on("click", ".approve-btn, .reject-btn", function () {
            var $btn = $(this);
            var eventId = $btn.data("id");
            var approve = $btn.hasClass("approve-btn");

            $.post("/AdminEvents/Validate", { id: eventId, approve: approve }, function (res) {
                if (res.success) {
                    var $cell = $btn.closest("td.action-cell");
                    $cell.html(approve
                        ? "<span class='text-success'>Approuvé</span>"
                        : "<span class='text-danger'>Rejeté</span>");
                } else {
                    alert("Erreur lors de la mise à jour du statut !");
                }
            });
        });
    </script>
}
