@using Newtonsoft.Json
@model List<PlanningTime.Models.Event>

@{
    ViewBag.Title = "Tableau de bord PlanningTime";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

<body class="d-flex flex-column min-vh-100">
    <main class="flex-grow-1">
        <div class="container py-4">
            <h2 class="mb-4 text-center">📊 Tableau de bord - @ViewBag.MonthName @ViewBag.Year</h2>

            <!-- 🔹 Filtres Année + Mois -->
            <form id="filterForm" class="row g-3 mb-4 justify-content-center">
                <div class="col-auto">
                    <select name="month" class="form-select">
                        @for (int m = 1; m <= 12; m++)
                        {
                            var monthName = new DateTime(2000, m, 1).ToString("MMMM", new System.Globalization.CultureInfo("fr-FR"));
                            <option value="@m" selected="@(m == (int)ViewBag.Month)">
                                @monthName
                            </option>
                        }
                    </select>
                </div>
                <div class="col-auto">
                    <select name="year" class="form-select">
                        @for (int y = DateTime.Now.Year - 5; y <= DateTime.Now.Year + 1; y++)
                        {
                            <option value="@y" selected="@(y == (int)ViewBag.Year)">
                                @y
                            </option>
                        }
                    </select>
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-primary">Filtrer</button>
                </div>
            </form>

            <!-- 🔹 Contenu dynamique (KPI + Graphiques) -->
            <div id="dashboardContent">
                @await Html.PartialAsync("_DashboardContent", Model)
            </div>
        </div>
    </main>

    <footer class="bg-darks text-white text-center py-3 mt-auto">
        © 2025 - PlanningTime
    </footer>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // ✅ Filtre AJAX
    $("#filterForm").on("submit", function (e) {
        e.preventDefault();
        $.get("@Url.Action("GetDashboard", "Home")", $(this).serialize(), function (data) {
            $("#dashboardContent").html(data);
        });
    });
</script>
